groups:
  - id: kestrel.common_attributes
    prefix: kestrel
    type: attribute_group
    brief: Common kestrel attributes
    note: "**TODO: Let's pick relevant attributes instead of kestrel.endpoint from this list, and/or use `url.full`**"
    attributes:
      #- ref: server.address
      #- ref: server.port
      #- ref: server.socket.address
      #- ref: url.scheme
      - ref: url.full
      - ref: network.protocol.name
      - ref: network.protocol.version
      - ref: network.transport
      - ref: network.type

  - id: metric.kestrel.active_connections
    type: metric
    metric_name: kestrel.active_connections
    brief: Number of connections that are currently active on the server.
    instrument: updowncounter
    unit: "{connection}"
    note: Corresponding `EventCounter` name is `current-connections`; Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes

  - id: metric.kestrel.connection.duration
    type: metric
    metric_name: kestrel.connection.duration
    brief: The duration of connections on the server.
    instrument: histogram
    unit: "s"
    note: Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes
    attributes:
      - ref: dotnet.error.code

  - id: metric.kestrel.rejected_connections
    type: metric
    metric_name: kestrel.rejected_connections
    brief: Number of connections rejected by the server.
    instrument: counter
    unit: "{connection}"
    note: |
      Connections are rejected when the currently active count exceeds the value configured with MaxConcurrentConnections.
      Meter name is `Microsoft.AspNetCore.Server.Kestrel`

      **TODO: do we ever will have other rejection reasons**
    extends: kestrel.common_attributes

  - id: metric.kestrel.queued_connections
    type: metric
    metric_name: kestrel.queued_connections
    brief: Number of connections that are currently queued and are waiting to start.
    instrument: updowncounter
    unit: "{connection}"
    note: Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes

  - id: metric.kestrel.queued_requests
    type: metric
    metric_name: kestrel.queued_requests
    brief: Number of HTTP requests on multiplexed connections (HTTP/2 and HTTP/3) that are currently queued and are waiting to start.
    instrument: updowncounter
    unit: "{connection}"
    note: Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes

  - id: metric.kestrel.upgraded_connections
    type: metric
    metric_name: kestrel.upgraded_connections
    brief: Number of connections that are currently upgraded (WebSockets). .
    instrument: updowncounter
    unit: "{connection}"
    note: |
      The number only tracks HTTP/1.1 connections. **TODO: can we add protocol info in dimensions so we can extend it to other versions/protocols? **
      Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes

  - id: metric.kestrel.tls_handshake.duration
    type: metric
    metric_name: kestrel.tls_handshake.duration
    brief: The duration of TLS handshakes on the server.
    instrument: histogram
    unit: "s"
    note: Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes
    attributes:
      - ref: dotnet.error.code

  - id: metric.kestrel.active_tls_handshakes
    type: metric
    metric_name: active_tls_handshakes
    brief: Number of TLS handshakes that are currently in progress on the server.
    instrument: updowncounter
    unit: "{handshake}"
    note: Meter name is `Microsoft.AspNetCore.Server.Kestrel`
    extends: kestrel.common_attributes