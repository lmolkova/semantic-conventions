groups:
  - id: attributes.messaging.trace.minimal
    type: attribute_group
    stability: experimental
    brief: >
        Defines minimal set of attributes used by all messaging systems.
    extends: attributes.messaging.common.minimal
    attributes:
      - ref: messaging.operation.name
        requirement_level: required
        sampling_relevant: true
      - ref: messaging.operation.type
        requirement_level:
          conditionally_required: If applicable.
        sampling_relevant: true
      - ref: messaging.destination.name
        requirement_level:
          conditionally_required: If span describes operation on a single message or if the value applies to all messages in the batch.
        sampling_relevant: true
      - ref: messaging.message.id
        requirement_level:
          recommended: If span describes operation on a single message.
      - ref: server.address
        sampling_relevant: true
      - ref: server.port
        sampling_relevant: true
        # TODO: add messaging.system once https://github.com/open-telemetry/build-tools/issues/192 is implemented
        # - ref: messaging.system
        #   sampling_relevant: true

  - id: span.messaging
    type: span
    stability: experimental
    brief: >
        Defines a full set of attributes used in messaging systems.
    extends: attributes.messaging.trace.minimal
    attributes:
      - ref: messaging.system
        requirement_level: required
        sampling_relevant: true
      - ref: messaging.client.id
        requirement_level: recommended
      - ref: messaging.destination.partition.id
        requirement_level:
          recommended: When applicable.
        sampling_relevant: true
      - ref: messaging.destination.template
        requirement_level:
          conditionally_required: >
            If available. Instrumentations MUST NOT use `messaging.destination.name` as template
            unless low-cardinality of destination name is guaranteed.
        sampling_relevant: true
      - ref: messaging.destination.temporary
        requirement_level:
          conditionally_required: If value is `true`. When missing, the value is assumed to be `false`.
      - ref: messaging.destination.anonymous
        requirement_level:
          conditionally_required: If value is `true`. When missing, the value is assumed to be `false`.
      - ref: messaging.consumer.group.name
        requirement_level:
          conditionally_required: If applicable.
        sampling_relevant: true
      - ref: messaging.destination.subscription.name
        requirement_level:
          conditionally_required: If applicable.
        sampling_relevant: true
      - ref: messaging.message.conversation_id
      - ref: messaging.message.envelope.size
        requirement_level: opt_in
      - ref: messaging.message.body.size
        requirement_level: opt_in
      - ref: messaging.batch.message_count
        requirement_level:
          conditionally_required: If the span describes an operation on a batch of messages.
      - ref: network.peer.address
        brief: Peer address of the messaging intermediary node where the operation was performed.
        requirement_level:
          recommended: If applicable for this messaging system.
        note: >
          Semantic conventions for individual messaging systems SHOULD document whether `network.peer.*` attributes are applicable.

          Network peer address and port are important when the application interacts with individual intermediary nodes directly,

          If a messaging operation involved multiple network calls (for example retries), the address of the last contacted node SHOULD be used.
      - ref: network.peer.port
        brief: Peer port of the messaging intermediary node where the operation was performed.
        requirement_level:
          recommended: if and only if `network.peer.address` is set.

  - id: messaging.network.attributes
    type: attribute_group
    stability: experimental
    brief: Attributes that describe messaging operation along with network information.
    extends: attributes.messaging.trace.minimal
    attributes:
      - ref: network.peer.address
        requirement_level: recommended
        note: >
          If an operation involved multiple network calls (for example retries), the address of the last contacted node SHOULD be used.
      - ref: network.peer.port
        requirement_level: recommended
