groups:
  - id: metric.http.server.duration
    type: metric
    metric_name: http.server.duration
    brief: "Measures the duration of inbound HTTP requests."
    instrument: histogram
    unit: "s"
    extends: attributes.http.server
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      # todo (lmolkova) build tools don't populate grandparent attributes
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version

  - id: metric.http.server.active_requests
    type: metric
    metric_name: http.server.active_requests
    brief: "Measures the number of concurrent HTTP requests that are currently in-flight."
    instrument: updowncounter
    unit: "{request}"
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      - ref: url.scheme
        requirement_level: required
        examples: ["http", "https"]
      - ref: server.address
        requirement_level: required
        brief: >
          Name of the local HTTP server that received the request.
        note: |
          Determined by using the first of the following that applies

          - The [primary server name](/specification/trace/semantic_conventions/http.md#http-server-definitions) of the matched virtual host. MUST only
            include host identifier.
          - Host identifier of the [request target](https://www.rfc-editor.org/rfc/rfc9110.html#target.resource)
            if it's sent in absolute-form.
          - Host identifier of the `Host` header

          SHOULD NOT be set if only IP address is available and capturing name would require a reverse DNS lookup.

      - ref: server.port
        requirement_level:
          conditionally_required: If not default (`80` for `http` scheme, `443` for `https`).
        brief: >
          Port of the local HTTP server that received the request.
        note: |
          Determined by using the first of the following that applies

          - Port identifier of the [primary server host](/specification/trace/semantic_conventions/http.md#http-server-definitions) of the matched virtual host.
          - Port identifier of the [request target](https://www.rfc-editor.org/rfc/rfc9110.html#target.resource)
            if it's sent in absolute-form.
          - Port identifier of the `Host` header

  - id: metric.http.server.request.size
    type: metric
    metric_name: http.server.request.size
    brief: "Measures the size of HTTP request messages (compressed)."
    instrument: histogram
    unit: "By"
    extends: attributes.http.server
    # TODO (trask) below attributes are identical to above in metric.http.server.duration
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      # todo (lmolkova) build tools don't populate grandparent attributes      
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version

  - id: metric.http.server.response.size
    type: metric
    metric_name: http.server.response.size
    brief: "Measures the size of HTTP response messages (compressed)."
    instrument: histogram
    unit: "By"
    extends: attributes.http.server
    # TODO (trask) below attributes are identical to above in metric.http.server.duration
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version

  - id: metric.http.client.duration
    type: metric
    metric_name: http.client.duration
    brief: "Measures the duration of outbound HTTP requests."
    instrument: histogram
    unit: "s"
    extends: attributes.http.client
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version
      - ref: server.socket.address
  - id: metric.http.client.request.size
    type: metric
    metric_name: http.client.request.size
    brief: "Measures the size of HTTP request messages (compressed)."
    instrument: histogram
    unit: "By"
    extends: attributes.http.client
    # TODO (trask) below attributes are identical to above in metric.http.client.duration
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version
      - ref: server.socket.address

  - id: metric.http.client.response.size
    type: metric
    metric_name: http.client.response.size
    brief: "Measures the size of HTTP response messages (compressed)."
    instrument: histogram
    unit: "By"
    extends: attributes.http.client
    # TODO (trask) below attributes are identical to above in metric.http.client.duration
    attributes:
      - ref: http.request.method
        note: |
          The HTTP request method usually contains one of a standard methods defined in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
          or [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html), or a custom one, which could be registered with [HTTP method registry](https://www.iana.org/assignments/http-methods/http-methods.xhtml).
          However, HTTP clients may send arbitrary method string resulting in a high cardinality of this attribute.

          Applications MAY use Hint API (once available) to specify a list of known HTTP request methods to be prioritized when capping dimensions if cardinality limit is reached.
      - ref: http.response.status_code
      - ref: network.protocol.name
      - ref: network.protocol.version
      - ref: server.socket.address
